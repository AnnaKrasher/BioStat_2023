---
title:
author: 
date: 
output:
---


```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)

```

# Задание 1. Ученые решили исследовать, кто больше подвержен гипертонии -- мужчины или женщины. Во вкладке "пол и гипертония" (или в файле hypertension.csv) приведены данные о гипертонии в случайной выборке из 100 жителей города N. Про каждого жителя известен пол и болеет ли он гипертонией. Определите, как мужской пол влияет на гипертонию,и укажите относительный риск (relative risk) и абсолютную разницу в рисках (risk difference). Как вы интерпретируете находки?. 

```{r}
data = read.csv("hypertension.csv")
data = data[,-1]
hyper = table(data)
print(c("p-value теста Фишера", fisher.test(hyper)$p))
#p-value > 0.05, пол не влияет на гипертонию
rr = (hyper[2,2]/(hyper[2,2]+hyper[2,1]))/(hyper[1,2]/(hyper[1,2]+hyper[1,1]))
print(c("Относительный риск", rr))
# относительный риск заболеть у мужчин в 2.2 раза выше, но недостоверно
rd = (hyper[2,2]/(hyper[2,2]+hyper[2,1]))-(hyper[1,2]/(hyper[1,2]+hyper[1,1]))
print(c("Разница рисков", rd))
# у мужчин риск заболеть на 8% выше, но недостоверно
```

# Задание 2. В Университете случилось отравление, пострадало 20 студентов. Все они обедали в университетской столовой. К моменту расследования остатки продуктов уже успели выкинуть и санэпидслужба провела опрос студентов: кто какие блюда ел на обед -- мясо, рыбу или салат. Для контроля взяли 80 студентов без симптомов отравления и их тоже опросили. Данные приведены во вкладке "отравление" (или в файле otravlenie.csv). Выберите подходящую меру ассоциации, чтобы определить, какое блюдо скорее всего привело к отравлению, и посчитайте ее для каждого блюда. Какие можно сделать выводы? 

```{r}
data2 = read.csv("otravlenie.csv")
data2 = data2[,-1]
meat = table(data2[,-2:-3])
fish = table(data2[,-1][,-2])
salad = table(data2[,-1:-2])
print(c("p-value теста Фишера для мяса", fisher.test(meat)$p))
#p-value < 0.05, мясо влияет на отравление
print(c("p-value теста Фишера для рыбы", fisher.test(fish)$p))
#p-value < 0.01, рыба влияет на отравление, сильнее чем мясо, скорее всего дело в ней
print(c("p-value теста Фишера для салата", fisher.test(salad)$p))
#p-value > 0.05, салат не влияет на отравление
```

# Задание 3.Фирма, занимающаяся арендой автомобилей, решила предоставить скидки более опытным водителям, поскольку они реже попадают в ДТП. Но страховая компания попросила предоставить данные за последний год, чтобы проверить, так ли это. Во вкладке "аренда машин" (или в файле carrental.csv) приведены данные по 100 случайно выбранным арендаторам, где указано наличие стажа, день года, когда арендатор взял машину в аренду, день года, когда он прекратил аренду (365-й день, если она оставалась в аренде на конец года) и не была ли аренда прекращена из-за ДТП (последний столбец). Определите, снижает ли стаж вероятность ДТП, используя разные меры случаемости и меры ассоциации. Какая мера лучше отражает реальность? Какие можно сделать выводы?

```{r}
data3 = read.csv("carrental.csv")
data3 = data3[,-1]
crash = table(data3[,-2:-3])
print(c("p-value теста Фишера, влияние опыта на ДТП", fisher.test(crash)$p))
#p-value < 0.05, опыт снижает вероятность ДТП
days = data3[,3]-data3[,2]
data3 = cbind(data3, data3[,4]/days)
colnames(data3)[5] = "Accidents per day"
data3[,5][data3[,5] > 0.01] = 2
data3[,5][data3[,5] < 0.01 & data3[,5] >0] = 1
crash_days = table(data3[,-2:-4])
print(c("p-value теста Фишера (Фримена-Гальтона), влияния опыта и количества дней на ДТП", fisher.test(crash_days[,-1])$p))
#p-value > 0.05, если учесть дни вождения, то опыт не влияет на то, как быстро случается ДТП
```
